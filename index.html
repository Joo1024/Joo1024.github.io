<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>你的名字 · 技术博客</title>
  <meta name="description" content="简约的技术笔记与博客（Markdown 渲染）。" />

  <style>
    :root{
      --bg:#0b0d10;
      --card:#11151b;
      --text:#e6edf3;
      --muted:#9aa4af;
      --link:#7aa2ff;
      --border:#1f2a37;
      --code:#0f1722;
      --max: 980px;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#ffffff;
        --card:#f6f8fa;
        --text:#111827;
        --muted:#6b7280;
        --link:#2563eb;
        --border:#e5e7eb;
        --code:#0b1020;
      }
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font: 16px/1.7 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "PingFang SC","Noto Sans CJK SC","Microsoft YaHei", Arial;
      background:var(--bg);
      color:var(--text);
    }
    a{color:var(--link);text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:var(--max);margin:0 auto;padding:28px 16px 60px}
    header{
      display:flex; gap:16px; align-items:flex-start; justify-content:space-between;
      padding:18px 0 12px;
      border-bottom:1px solid var(--border);
    }
    .brand h1{margin:0;font-size:20px;letter-spacing:.2px}
    .brand p{margin:6px 0 0;color:var(--muted);font-size:14px}
    nav{display:flex;gap:14px;flex-wrap:wrap;justify-content:flex-end}
    nav a{font-size:14px;color:var(--muted)}
    nav a:hover{color:var(--text)}
    main{display:grid;grid-template-columns: 320px 1fr; gap:18px; padding-top:18px}
    @media (max-width: 860px){ main{grid-template-columns:1fr} }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:14px;
      padding:14px;
      box-shadow: 0 1px 0 rgba(0,0,0,.08);
    }
    .sidebar .search{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:transparent;
      color:var(--text);
      outline:none;
    }
    .sidebar .hint{margin:10px 2px 0;color:var(--muted);font-size:13px}
    .posts{margin-top:14px; display:flex; flex-direction:column; gap:10px}
    .post-item{
      padding:10px 10px;
      border:1px solid var(--border);
      border-radius:12px;
      background: transparent;
    }
    .post-item a{display:block}
    .post-title{margin:0;font-size:14px;color:var(--text)}
    .post-meta{margin:4px 0 0;color:var(--muted);font-size:12px;display:flex;gap:8px;flex-wrap:wrap}
    .tag{border:1px solid var(--border);padding:1px 8px;border-radius:999px;font-size:12px;color:var(--muted)}

    article h2{margin:0 0 6px;font-size:18px}
    article .article-meta{color:var(--muted);font-size:13px;margin-bottom:12px}
    .content{
      border-top:1px solid var(--border);
      padding-top:14px;
    }

    /* Markdown content */
    .md{word-break:break-word}
    .md h1,.md h2,.md h3{line-height:1.3}
    .md h1{font-size:28px;margin:0 0 12px}
    .md h2{font-size:22px;margin:22px 0 10px}
    .md h3{font-size:18px;margin:18px 0 8px}
    .md p{margin:10px 0}
    .md blockquote{
      margin:12px 0;
      padding:10px 12px;
      border-left:3px solid var(--border);
      color:var(--muted);
      background: rgba(127,127,127,.06);
      border-radius:10px;
    }
    .md pre{
      background:var(--code);
      padding:12px;
      border-radius:12px;
      overflow:auto;
      border:1px solid var(--border);
    }
    .md code{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size: 0.95em}
    .md pre code{font-size:0.92em}
    .md img{max-width:100%;border-radius:12px;border:1px solid var(--border)}
    .md hr{border:none;border-top:1px solid var(--border);margin:18px 0}
    .md table{border-collapse:collapse;width:100%;overflow:auto;display:block}
    .md th,.md td{border:1px solid var(--border);padding:8px 10px}
    .md a{word-break:break-all}
    footer{margin-top:26px;color:var(--muted);font-size:13px}
    .btn{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:10px;border:1px solid var(--border);
      color:var(--muted);
    }
    .btn:hover{color:var(--text);text-decoration:none;border-color: rgba(127,127,127,.4)}
  </style>

  <!-- highlight.js (for code blocks) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1 id="siteTitle">你的名字</h1>
        <p id="siteSubtitle">简约技术博客 · Markdown 驱动 · GitHub Pages</p>
      </div>
      <nav>
        <a id="homeLink" href="./">首页</a>
        <a id="githubLink" href="https://github.com/yourname" target="_blank" rel="noreferrer">GitHub</a>
        <a href="mailto:you@example.com">Email</a>
      </nav>
    </header>

    <main>
      <aside class="sidebar card">
        <input id="q" class="search" placeholder="搜索标题 / 标签…" />
        <div class="hint">文章列表来自 <code>posts.json</code>；Markdown 放在 <code>posts/</code>。</div>

        <div class="posts" id="posts"></div>

        <footer>
          <a class="btn" id="rssBtn" href="#" title="可选：你可以后续再做 RSS">RSS（可选）</a>
          <div style="margin-top:10px">© <span id="year"></span> <span id="author"></span></div>
        </footer>
      </aside>

      <section class="card">
        <article>
          <h2 id="viewTitle">欢迎</h2>
          <div class="article-meta" id="viewMeta">选择左侧文章开始阅读</div>
          <div class="content md" id="view"></div>
        </article>
      </section>
    </main>
  </div>

  <!-- marked (Markdown renderer) -->
  <script src="https://cdn.jsdelivr.net/npm/marked@12.0.2/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/highlight.min.js"></script>

  <script>
    // ======= 站点信息（按需改） =======
    const SITE = {
      title: "你的名字",
      subtitle: "简约技术博客 · Markdown 驱动 · GitHub Pages",
      author: "你的名字",
      github: "https://github.com/yourname",
      // 默认欢迎页（可选）：比如 README.md 或 posts/hello.md
      defaultPost: ""
    };

    document.getElementById("siteTitle").textContent = SITE.title;
    document.getElementById("siteSubtitle").textContent = SITE.subtitle;
    document.getElementById("author").textContent = SITE.author;
    document.getElementById("year").textContent = new Date().getFullYear();
    document.getElementById("githubLink").href = SITE.github;

    // marked 配置 + 高亮
    marked.setOptions({
      gfm: true,
      breaks: false,
      highlight(code, lang) {
        try {
          if (lang && hljs.getLanguage(lang)) return hljs.highlight(code, { language: lang }).value;
          return hljs.highlightAuto(code).value;
        } catch (e) {
          return code;
        }
      }
    });

    const $posts = document.getElementById("posts");
    const $view = document.getElementById("view");
    const $viewTitle = document.getElementById("viewTitle");
    const $viewMeta = document.getElementById("viewMeta");
    const $q = document.getElementById("q");

    let ALL = []; // posts list

    function escapeHTML(s){
      return (s ?? "").replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    function renderList(items){
      $posts.innerHTML = items.map(p => {
        const tags = (p.tags || []).slice(0, 6).map(t => `<span class="tag">${escapeHTML(t)}</span>`).join("");
        const date = p.date ? `<span>${escapeHTML(p.date)}</span>` : "";
        return `
          <div class="post-item">
            <a href="?p=${encodeURIComponent(p.path)}" data-path="${escapeHTML(p.path)}">
              <div class="post-title">${escapeHTML(p.title || p.path)}</div>
              <div class="post-meta">${date}${tags ? `<span style="margin-left:auto"></span>${tags}` : ""}</div>
            </a>
          </div>`;
      }).join("");
    }

    async function loadPosts(){
      try{
        const res = await fetch("./posts.json", { cache: "no-store" });
        if(!res.ok) throw new Error("posts.json not found");
        const list = await res.json();
        // sort by date desc if present
        list.sort((a,b)=> (b.date||"").localeCompare(a.date||""));
        ALL = list;
        renderList(ALL);
      }catch(err){
        $posts.innerHTML = `
          <div class="hint" style="margin-top:12px">
            没有找到 <code>posts.json</code>。<br/>
            请在仓库根目录创建它，然后放 Markdown 到 <code>posts/</code>。
          </div>`;
      }
    }

    async function loadMarkdown(path){
      if(!path){
        $viewTitle.textContent = "欢迎";
        $viewMeta.textContent = "选择左侧文章开始阅读";
        $view.innerHTML = `
          <p>你可以：</p>
          <ul>
            <li>在 <code>posts/</code> 放 Markdown 文件</li>
            <li>在 <code>posts.json</code> 维护文章列表</li>
            <li>点击左侧文章加载阅读，支持直链 <code>?p=posts/xxx.md</code></li>
          </ul>`;
        return;
      }

      try{
        const res = await fetch(path, { cache: "no-store" });
        if(!res.ok) throw new Error("md not found");

        const md = await res.text();
        $view.innerHTML = marked.parse(md);

        // Title/meta from posts.json if exists
        const found = ALL.find(x => x.path === path);
        $viewTitle.textContent = found?.title || path;
        $viewMeta.textContent = found?.date
          ? `${found.date}${found.tags?.length ? " · " + found.tags.join(" / ") : ""}`
          : path;

        // highlight after render (for some cases)
        document.querySelectorAll("pre code").forEach(el => hljs.highlightElement(el));
      }catch(err){
        $viewTitle.textContent = "加载失败";
        $viewMeta.textContent = path;
        $view.innerHTML = `<p>找不到该文件或无法加载：<code>${escapeHTML(path)}</code></p>`;
      }
    }

    function getQueryParam(name){
      const u = new URL(location.href);
      return u.searchParams.get(name);
    }

    // click: SPA style (prevent full reload)
    document.addEventListener("click", (e)=>{
      const a = e.target.closest('a[data-path]');
      if(!a) return;
      e.preventDefault();
      const path = a.getAttribute("data-path");
      const u = new URL(location.href);
      u.searchParams.set("p", path);
      history.pushState({}, "", u);
      loadMarkdown(path);
    });

    window.addEventListener("popstate", ()=>{
      loadMarkdown(getQueryParam("p") || SITE.defaultPost);
    });

    // search filter
    $q.addEventListener("input", ()=>{
      const kw = $q.value.trim().toLowerCase();
      const filtered = !kw ? ALL : ALL.filter(p => {
        const hay = (p.title||"") + " " + (p.path||"") + " " + (p.tags||[]).join(" ");
        return hay.toLowerCase().includes(kw);
      });
      renderList(filtered);
    });

    (async function init(){
      await loadPosts();
      loadMarkdown(getQueryParam("p") || SITE.defaultPost);
    })();
  </script>
</body>
</html>
